// Database Helper Scripts
// يمكنك تشغيل هذه الأوامر في MongoDB Shell أو Compass

// ============================================
// 1. إنشاء حساب Admin
// ============================================
db.users.updateOne(
  { email: "admin@esdaly.com" },
  { $set: { role: "admin" } }
)

// ============================================
// 2. عرض جميع المستخدمين
// ============================================
db.users.find().pretty()

// ============================================
// 3. البحث عن مستخدم
// ============================================
db.users.findOne({ email: "admin@esdaly.com" })

// ============================================
// 4. عرض جميع المنتجات
// ============================================
db.products.find().pretty()

// ============================================
// 5. عرض المنتجات النشطة فقط
// ============================================
db.products.find({ isActive: true }).pretty()

// ============================================
// 6. عرض جميع الطلبات
// ============================================
db.orders.find().pretty()

// ============================================
// 7. عرض الطلبات المعلقة
// ============================================
db.orders.find({ status: "pending" }).pretty()

// ============================================
// 8. إحصائيات سريعة
// ============================================
print("عدد المستخدمين: " + db.users.countDocuments())
print("عدد المنتجات: " + db.products.countDocuments())
print("عدد الطلبات: " + db.orders.countDocuments())
print("عدد الفئات: " + db.categories.countDocuments())

// ============================================
// 9. حساب إجمالي الإيرادات
// ============================================
db.orders.aggregate([
  { $match: { status: { $ne: "cancelled" } } },
  { $group: { _id: null, total: { $sum: "$pricing.total" } } }
])

// ============================================
// 10. حذف جميع البيانات (احذر!)
// ============================================
// db.users.deleteMany({})
// db.products.deleteMany({})
// db.orders.deleteMany({})
// db.categories.deleteMany({})
// db.reviews.deleteMany({})

// ============================================
// 11. إنشاء Indexes لتحسين الأداء
// ============================================
db.users.createIndex({ email: 1 }, { unique: true })
db.products.createIndex({ name: "text", description: "text" })
db.products.createIndex({ category: 1, isActive: 1 })
db.orders.createIndex({ user: 1, createdAt: -1 })
db.orders.createIndex({ orderNumber: 1 }, { unique: true })

// ============================================
// 12. عرض Indexes
// ============================================
db.users.getIndexes()
db.products.getIndexes()

// ============================================
// 13. البحث في المنتجات
// ============================================
db.products.find({ $text: { $search: "حجاب" } })

// ============================================
// 14. عرض أفضل المنتجات مبيعاً
// ============================================
db.products.find().sort({ "sales.count": -1 }).limit(10).pretty()

// ============================================
// 15. عرض أحدث الطلبات
// ============================================
db.orders.find().sort({ createdAt: -1 }).limit(10).pretty()
